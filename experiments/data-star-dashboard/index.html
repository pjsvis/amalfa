<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POLYVIS | REACTOR DASHBOARD</title></head>

    <!-- DATASTAR -->
    <script type="module" src="./datastar.js"></script>

    <!-- STYLES: Terminal Brutalist -->
    <style>
        :root {
            --bg-canvas: #0C0C0C;
            --border-thick: 2px solid #FFFFFF;
            --text-primary: #CCCCCC;
            --text-dim: #666666;</style>

            --ansi-black: #0C0C0C;
            --ansi-white: #CCCCCC;
            --ansi-bright-white: #FFFFFF;
            --ansi-red: #CD0000;
            --ansi-green: #00CD00;
            --ansi-cyan: #00CDCD;
            --ansi-yellow: #CDCD00;

            --font-mono: 'Courier New', Courier, monospace;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-canvas);
            color: var(--text-primary);
            font-family: var(--font-mono);

            /* CORE LAYOUT: Viewport Lock */
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* SLAB 1: HEADER */
        .slab-header {
            height: 60px;
            border-bottom: var(--border-thick);
            flex-shrink: 0;

            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
        }

        .brand {
            font-weight: bold;
            font-size: 20px;
            color: var(--ansi-cyan);
            letter-spacing: -1px;
        }

        .status-indicator {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background-color: var(--ansi-green);
            border: 2px solid var(--ansi-white);
        }

        /* SLAB 2: MAIN STAGE */
        .slab-stage {
            flex-grow: 1;
            min-height: 0; /* Critical for Flexbox recursion */

            display: grid;
            grid-template-columns: 250px 1fr 350px;
            overflow: hidden;
        }

        .panel-left {
            grid-column: 1;
            border-right: var(--border-thick);
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stage-canvas {
            grid-column: 2;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;

            /* Dot grid pattern */
            background-image: radial-gradient(var(--ansi-white) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .panel-right {
            grid-column: 3;
            border-left: var(--border-thick);
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        /* SLAB 3: FOOTER */
        .slab-footer {
            height: 40px;
            border-top: var(--border-thick);
            flex-shrink: 0;

            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            font-size: 12px;
            text-transform: uppercase;
        }

        /* COMPONENTS */
        .metric-card {
            border: var(--border-thick);
            padding: 16px;
            background: var(--ansi-black);
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--ansi-white);
        }

        .metric-unit {
            font-size: 14px;
            color: var(--text-dim);
            margin-left: 4px;
        }

        /* THE CSS GRAPH: Fuel Rod */
        .rod-container {
            width: 100px;
            height: 400px;
            border: var(--border-thick);
            padding: 4px;
            position: relative;
            background: var(--ansi-black);
        }

        .fuel-rod {
            width: calc(100% - 8px);
            height: 0%; /* Driven by server via $rod_height signal */
            background: var(--ansi-cyan);
            position: absolute;
            bottom: 4px;
            left: 4px;
            transition: height 0.1s linear;
            border: 1px solid var(--ansi-white);
        }

        .rod-label {
            margin-top: 16px;
            font-size: 14px;
            color: var(--ansi-cyan);
            text-align: center;
        }

        .status-display {
            font-size: 24px;
            font-weight: bold;
            padding: 8px;
            text-align: center;
            border: var(--border-thick);
        }

        .status-idle { color: var(--ansi-cyan); }
        .status-processing { color: var(--ansi-yellow); }
        .status-flushing { color: var(--ansi-red); }

        .log-entry {
            font-size: 12px;
            line-height: 1.6;
            margin-bottom: 8px;
            border-bottom: 1px solid var(--text-dim);
            padding-bottom: 4px;
        }
    </style>
</head>
<!--
    DATASTAR CONFIGURATION:
    1. Signals: Define initial state for cpu_temp, ingestion_rate, status, rod_height
    2. On Load: Connect to SSE stream at /feed endpoint
-->
<body
    data-signals='{"cpu_temp":"0.0","ingestion_rate":0,"status":"INIT","rod_height":"0%"}'
    data-on-load="@get('/feed')"
>

    <!-- SLAB 1: HEADER -->
    <header class="slab-header">
        <div class="brand">POLYVIS // REACTOR</div>
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span>LIVE FEED</span>
        </div>
    </header>

    <!-- SLAB 2: MAIN STAGE -->
    <main class="slab-stage">

        <!-- LEFT PANEL: METRICS -->
        <aside class="panel-left">
            <div class="metric-card">
                <div class="metric-label">CPU Temperature</div>
                <div>
                    <span class="metric-value" data-text="$cpu_temp">0.0</span>
                    <span class="metric-unit">Â°C</span>
                </div>
            </div>

            <div class="metric-card"></div>
                <div class="metric-label">Ingestion Rate</div>
                <div>
                    <span class="metric-value" data-text="$ingestion_rate">0</span>
                    <span class="metric-unit">events/sec</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-label">System Status</div>
                <div class="status-display"
                     data-text="$status"
                     data-class="{
                        'status-idle': $status === 'IDLE',
                        'status-processing': $status === 'PROCESSING',
                        'status-flushing': $status === 'FLUSHING'
                     }">
                        INIT
                    </div>
            </div>
        </aside>

        <!-- CENTER STAGE: CSS GRAPH -->
        <section class="stage-canvas">
            <div class="rod-container">
                <!-- BIND HEIGHT TO SERVER SIGNAL -->
                <div class="fuel-rod" data-attr-style="`height: ${$rod_height}`"></div>
            </div>
            <div class="rod-label">REACTOR CORE LEVEL</div>
        </section>

        <!-- RIGHT PANEL: LOGS -->
        <aside class="panel-right">
            <div style="margin-bottom: 16px; font-weight: bold; border-bottom: var(--border-thick); padding-bottom: 8px;">
                SYSTEM LOGS
            </div>

            <div style="font-size: 12px; line-height: 1.5; color: var(--text-dim);">
                <div class="log-entry"><span style="color: var(--ansi-green)">[SYSTEM]</span> Uplink established.</div>
                <div class="log-entry">[SYSTEM] Listening for Datastar signals...</div>
                <div class="log-entry">[SYSTEM] Metrics stream initialized.</div>
                <div class="log-entry">[REACTOR] Core monitoring active.</div>
                <div class="log-entry">[INFO] Server-side logic driving UI.</div>
                <div class="log-entry">[INFO] Zero client-side JavaScript.</div>
                <div class="log-entry">[INFO] Terminal Brutalist mode active.</div>
            </div>
        </aside>

    </main>

    <!-- SLAB 3: FOOTER -->
    <footer class="slab-footer">
        <div>Runtime: Bun</div>
        <div>Framework: Datastar</div>
        <div>Update Rate: 10Hz</div>
    </footer>

</body>
</html>

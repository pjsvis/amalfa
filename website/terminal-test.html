<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>terminal | docs</title>
    <!-- Datastar -->
    <script type="module" src="https://cdn.jsdelivr.net/gh/starfederation/datastar@1.0.0-RC.7/bundles/datastar.js"></script>
    <style>
        :root {
        
            
            
            --bg: var(--black);
            --fg: var(--white);
            --accent: var(--green);
            --border: var(--white);
            --dim: var(--yellow);
            --link: var(--cyan);
            --error: var(--red);
            
            font-family: monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        
        body {
            background: var(--bg);
            color: var(--fg);
            display: grid;
            /* Explicit rows: header + main + footer + borders */
            grid-template-rows: 3ch 1fr 2ch;
            grid-template-areas:
                "header"
                "main"
                "footer";
            min-height: 0;
        }
        
        header {
            grid-area: header;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 2ch;
            height: 3ch;
            overflow: hidden;
            line-height: 1;
            contain: strict;
        }
        
        .brand {
            color: var(--accent);
            font-weight: bold;
        }
        
        nav {
            display: flex;
            gap: 2ch;
            margin-left: auto;
        }
        
        nav a {
            color: var(--fg);
            text-decoration: none;
        }
        
        nav a:hover, nav a.active {
            color: var(--accent);
            text-decoration: underline;
        }
        
        /* Main layout: LHS sidebar + RHS container */
        main {
            grid-area: main;
            display: grid;
            grid-template-columns: 45ch 1fr;
            grid-template-areas: "lhs rhs";
            gap: 1px;
            background: var(--border);
            overflow: hidden;
            min-height: 0;
            contain: strict;
        }
        
        /* LHS Panel: narrow, vertical, scrollable */
        .lhs {
            grid-area: lhs;
            background: var(--bg);
            padding: 1ch;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        /* RHS Panel: container with flowing blocks */
        .rhs {
            grid-area: rhs;
            background: var(--bg);
            padding: 1ch;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            align-content: flex-start;
            gap: 1ch;
        }
        
        /* LHS Widget: full width of sidebar */
        .lhs-widget {
            background: var(--bg);
            padding: 1ch;
            border-bottom: 1px solid var(--border);
        }
        
        .lhs-widget:last-child {
            border-bottom: none;
        }
        
        /* RHS Block: GAME ENGINE STYLE - collision detection and bounce */
        /* 
           Screen map: ~46ch available vertical space
           Algorithm: IF (block.bottom > viewport.bottom - BUFFER) THEN reduce
           Buffer zone: Never approach within 5ch of viewport edge
        */
        .rhs-block {
            background: var(--bg);
            padding: 1ch 2ch;
            width: fit-content;
            min-width: min(50ch, 100%);
            max-width: 70ch;
            /* Collision detection: max 30ch keeps us well clear of 46ch limit */
            max-height: 30ch;
            overflow-y: auto;
            overflow-x: hidden;
            border: 1px solid var(--border);
            contain: layout; /* Isolate this block's layout */
        }
        
        /* Emergency collision: viewport is short, back off aggressively */
        @media (max-height: 50ch) {
            .rhs-block {
                max-height: 20ch; /* Doom-style: aggressive reduction */
            }
        }
        
        /* Long-form: known to be big, keep it extra short */
        .rhs-block.long {
            max-height: 25ch; /* Extra margin for safety */
        }
        
        /* Short content: can relax a bit */
        .rhs-block.short {
            max-height: 35ch; /* But still within safe zone */
        }
        
        .widget-title {
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 1ch;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Typography */
        h1 {
            color: var(--accent);
            font-size: 1rem;
            margin: 1ch 0;
        }
        
        h2 {
            color: var(--bright-yellow);
            font-size: 1rem;
            margin: 1ch 0;
        }
        
        h3 {
            color: var(--cyan);
            font-size: 1rem;
            margin: 0.5ch 0;
        }
        
        p {
            margin: 0.5ch 0;
        }
        
        a {
            color: var(--link);
            text-decoration: none;
        }
        
        pre {
            background: var(--black);
            border: 1px solid var(--border);
            padding: 1ch;
            margin: 1ch 0;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 12px;
            color: var(--bright-green);
            width: fit-content;
            max-width: min(80ch, 100%);
            min-width: 100%;
        }
        
        code {
            color: var(--bright-green);
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 13px;
        }
        
        th, td {
            border: 1px solid var(--border);
            padding: 0.5ch 1ch;
            text-align: left;
        }
        
        th {
            color: var(--accent);
            background: var(--black);
        }
        
        ul {
            margin: 0.5ch 0;
            padding-left: 3ch;
        }
        
        li {
            margin: 0.25ch 0;
        }
        
        .status {
            color: var(--accent);
        }
        
        .dim {
            color: var(--dim);
        }
        
        footer {
            grid-area: footer;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2ch;
            height: 2ch;
            font-size: 12px;
            color: var(--dim);
            overflow: hidden;
            line-height: 1;
            contain: strict;
        }
        
        /* Responsive: stack on narrow screens */
        @media (max-width: 100ch) {
            main {
                grid-template-columns: 1fr;
                grid-template-areas: "lhs" "rhs";
            }
            
            .lhs {
                max-height: 40vh;
            }
        }
        /* Window Controls & Wrappers */
        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1ch;
        }
        
        .widget-controls {
            display: flex;
            gap: 1ch;
        }

        .control-btn {
            color: var(--dim);
            font-family: monospace;
            cursor: pointer;
            user-select: none;
            margin-left: 1ch;
        }
        
        .control-btn:hover {
            color: var(--fg);
        }
        
        /* Hide maximize button on small blocks by default logic in JS/HTML */

        .rhs-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            width: fit-content;
            max-width: 70ch;
        }
        
        .rhs-wrapper .rhs-block {
            width: 100%;
        }

        .more-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            background: linear-gradient(transparent, var(--bg) 80%);
            color: var(--yellow);
            padding-top: 2ch;
            padding-bottom: 0.5ch;
            font-size: 11px;
            pointer-events: none;
            display: none;
            z-index: 10;
        }
        
        .more-indicator span {
            background: var(--bg);
            padding: 0.2ch 1ch;
            border: 1px dashed var(--dim);
        }
        
        .more-indicator.visible {
            display: block;
        }

        /* Focus Mode Logic */
        .rhs.focus-mode {
            display: grid !important;
            grid-template-columns: 1fr 40ch;
            grid-template-rows: 1fr; /* Use 1fr instead of 100% for safer grid sizing */
            overflow: hidden;
            gap: 1ch;
        }
        
        .rhs-sidebar {
            display: none;
            flex-direction: column;
            gap: 0.5ch;
            overflow-y: auto;
            height: 100%;
            padding-right: 1ch; /* Scrollbar space */
        }
        
        .rhs.focus-mode .rhs-sidebar {
            display: flex;
            grid-column: 2;
        }
        
        /* When in main area of focus mode */
        .rhs.focus-mode > .rhs-block.expanded,
        .rhs.focus-mode > .rhs-wrapper:has(.rhs-block.expanded) {
            grid-column: 1;
            width: 100% !important; /* Fill grid cell explicitly */
            height: 100% !important;
            margin: 0 !important;
        }
        
        .rhs-sidebar {
            display: none;
            flex-direction: column;
            gap: 0.5ch;
            overflow-y: auto;
            height: 100%;
            padding-left: 1ch; /* Spacing */
            border-left: 1px dashed var(--dim); /* Visual separator */
        }
        
        /* Items in sidebar */
        .rhs-sidebar .rhs-block,
        .rhs-sidebar .rhs-wrapper {
            width: 100% !important;
            /* Remove fixed max-height !important so .collapsed class controls it */
            min-height: 0;
            overflow: hidden;
            margin: 0;
            flex-shrink: 0;
        }
        
        /* Default state in sidebar is usually collapsed, managed by JS adding .collapsed */
        
        .rhs-sidebar .rhs-block {
            padding: 0.5ch 2ch;
        }
        
        .rhs-sidebar .widget-header {
            margin: 0;
            height: 2ch;
        }
        
        .rhs-sidebar .more-indicator {
            display: none !important;
        }
    </style>
</head>
<body data-store="{ focused: '' }">
    <header>
        <span class="brand">terminal</span>
        <span> | docs</span>
        <nav>
            <a href="#" class="active">s shop</a>
            <a href="#">a account</a>
            <a href="#">c cart $0 [0]</a>
        </nav>
    </header>
    
    <main>
        <div class="lhs">
            <div class="lhs-widget">
                <div class="widget-title">Bun v1.3.8 Markdown Rendering</div>
                <p class="dim">~/docs/bun-markdown > index.html</p>
                
                <h1>Server-Side Markdown Test</h1>
                
                <p>Terminal-style design using Bun's server-side markdown capabilities:</p>
                
                <ul>
                    <li>Monospace typography only</li>
                    <li>8-16 ANSI colors maximum</li>
                    <li>Grid layout using ch units</li>
                    <li>No images, animations, rounded corners</li>
                    <li>Every character earns its place</li>
                </ul>
                
                <h2>Status Report</h2>
                
                <table>
                    <tr>
                        <th>Feature</th>
                        <th>Status</th>
                    </tr>
                    <tr>
                        <td>Bun.markdown API</td>
                        <td class="status">ACTIVE</td>
                    </tr>
                    <tr>
                        <td>SSR Rendering</td>
                        <td class="status">ACTIVE</td>
                    </tr>
                    <tr>
                        <td>Cache Layer</td>
                        <td class="status">ACTIVE</td>
                    </tr>
                    <tr>
                        <td>Extended Options</td>
                        <td style="color: var(--error);">UNAVAILABLE</td>
                    </tr>
                </table>
            </div>
            
            <div class="lhs-widget">
                <div class="widget-title">Quick Navigation</div>
                <p>
                    <strong>Docs:</strong> <a href="#">architecture</a> | 
                    <a href="#">playbooks</a> | 
                    <a href="#">debriefs</a> | 
                    <a href="#">api</a>
                </p>
                <p class="dim">
                    Press <code>q</code> to quit, <code>h/j/k/l</code> to navigate
                </p>
            </div>
        </div>
        
        <div class="rhs">
            <div class="rhs-block long" id="doc-long">
                <div class="widget-header">
                    <div class="widget-title">üìö Long-Form Documentation</div>
                    <div class="widget-controls">
                        <span class="control-btn btn-min" onclick="toggleMinimize(this)">[-]</span>
                        <span class="control-btn btn-max" 
                              data-on:click="$focused == 'doc-long' ? $focused = '' : $focused = 'doc-long'; layout($focused)"
                              data-text="$focused == 'doc-long' ? '[RST]' : '[MAX]'">[MAX]</span>
                    </div>
                </div>
                
                <p class="dim">
                    This block demonstrates vertical scrolling when content exceeds the maximum height.
                    The design philosophy emphasizes information density without sacrificing readability.
                </p>
                
                <h3>Design Principles</h3>
                
                <p>
                    The terminal aesthetic works because it imposes strict constraints. 
                    Every character must earn its place on screen. This mirrors the discipline 
                    of early computing environments where memory and display real estate were 
                    severely limited resources.
                </p>
                
                <p>
                    By enforcing these constraints artificially in modern web development, 
                    we achieve several benefits: faster rendering times, clearer information 
                    hierarchy, and a distinctive visual identity that stands apart from the 
                    homogenized flat design patterns prevalent today.
                </p>
                
                <h3>Implementation Notes</h3>
                
                <p>
                    The CSS Grid layout provides structural rigidity while Flexbox within 
                    panels allows for organic content flow. The combination of these two 
                    layout systems creates a responsive yet controlled environment.
                </p>
                
                <ul>
                    <li>Fixed grid for main layout areas</li>
                    <li>Flexbox for widget content arrangement</li>
                    <li>ch units ensure typographic consistency</li>
                    <li>Overflow handling via scroll containment</li>
                </ul>
                
                <p>
                    Each widget is bounded by explicit maximum dimensions. When content 
                    exceeds these bounds, vertical scrolling is enabled within the widget 
                    itself, maintaining the overall layout integrity while preserving access 
                    to all information.
                </p>
                
                <p class="dim">
                    This block continues to demonstrate that the layout system properly 
                    handles overflow scenarios. You should be able to scroll within this 
                    panel to see all the content while other panels remain static.
                </p>
                
                <h3>Performance Considerations</h3>
                
                <p>
                    The use of CSS containment and strict overflow rules ensures that 
                    scrolling performance remains smooth even when multiple panels contain 
                    substantial content. No JavaScript is required for the basic layout 
                    functionality.
                </p>
                
                <p>
                    Server-side rendering with Bun's native markdown API provides 
                    sub-millisecond response times for content generation. The LRU cache 
                    layer further optimizes repeated requests.
                </p>
                
                <p class="dim" style="text-align: center; border-top: 1px dashed var(--dim); margin-top: 1ch; padding-top: 0.5ch;">
                    --- more below ---
                </p>
            </div>
            
            <div class="rhs-block" id="doc-md">
                <div class="widget-header">
                    <div class="widget-title">üìù Markdown Rendering Demo</div>
                    <div class="widget-controls">
                        <span class="control-btn btn-min" onclick="toggleMinimize(this)">[-]</span>
                    </div>
                </div>
                <h3>Implementation Example</h3>
                
                <pre><code>// Server-side markdown rendering
const html = Bun.markdown.html(markdown);

// With caching layer
const result = getRenderedHtml(markdown, docId);
console.log(`Cached: ${result.cached}`);
console.log(`Render time: ${result.renderTime.toFixed(2)}ms`);</code></pre>
                
                <p class="dim">
                    The terminal aesthetic works because it can't add more‚Äîthe medium 
                    won't allow it. Every element justified by function.
                </p>
            </div>
            
            <div class="rhs-block" id="doc-bundle">
                <div class="widget-header">
                    <div class="widget-title">Bundle Analysis (OH-107)</div>
                    <div class="widget-controls">
                        <span class="control-btn btn-min" onclick="toggleMinimize(this)">[-]</span>
                    </div>
                </div>
                
                <pre>
Input Files:        [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 611
Total Input:        [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 13.15 MB
Total Output:       [‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 3.77 MB
Compression:        [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë] 28.6%
External Packages:  [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 100
                </pre>
                
                <p>
                    <strong>Largest dependency:</strong> tokenizers (~8 MB)<br>
                    <strong>Bundle efficiency:</strong> 28.6%
                </p>
            </div>
            
            <div class="rhs-block" id="doc-perf">
                <div class="widget-header">
                    <div class="widget-title">Performance Metrics</div>
                    <div class="widget-controls">
                        <span class="control-btn btn-min" onclick="toggleMinimize(this)">[-]</span>
                    </div>
                </div>
                
                <table>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                    </tr>
                    <tr>
                        <td>Render Time</td>
                        <td class="status">2.4ms</td>
                    </tr>
                    <tr>
                        <td>Cache Hit</td>
                        <td class="status">99.8%</td>
                    </tr>
                    <tr>
                        <td>Memory</td>
                        <td>14.2 MB</td>
                    </tr>
                    <tr>
                        <td>CPU</td>
                        <td>0.3%</td>
                    </tr>
                </table>
            </div>
            
            <div class="rhs-block" id="doc-arch">
                <div class="widget-header">
                    <div class="widget-title">System Architecture</div>
                    <div class="widget-controls">
                        <span class="control-btn btn-min" onclick="toggleMinimize(this)">[-]</span>
                    </div>
                </div>
                
                <p class="dim">
                    The design follows a strict terminal aesthetic with fixed grid layouts, 
                    bounded widgets, and ANSI color constraints. Each panel serves a specific 
                    function without decorative elements.
                </p>
                
                <ul>
                    <li>CSS Grid for main structure</li>
                    <li>Flexbox for flowing blocks</li>
                    <li>ch units for typography</li>
                    <li>Fit-content for dynamic sizing</li>
                </ul>
            </div>
            
            <div class="rhs-block" id="doc-config">
                <div class="widget-header">
                    <div class="widget-title">Configuration</div>
                    <div class="widget-controls">
                        <span class="control-btn btn-min" onclick="toggleMinimize(this)">[-]</span>
                    </div>
                </div>
                
                <pre><code>{
  "theme": "terminal",
  "colors": 8,
  "layout": "grid",
  "font": "monospace",
  "scroll": "auto"
}</code></pre>
            </div>
            
            <div class="rhs-block" id="doc-deps">
                <div class="widget-header">
                    <div class="widget-title">Dependencies</div>
                    <div class="widget-controls">
                        <span class="control-btn btn-min" onclick="toggleMinimize(this)">[-]</span>
                    </div>
                </div>
                
                <p>
                    <strong>Core:</strong> Bun v1.3.8<br>
                    <strong>Runtime:</strong> JavaScriptCore<br>
                    <strong>HTTP:</strong> Built-in<br>
                    <strong>Markdown:</strong> Native API
                </p>
            </div>
            
            <div class="rhs-block" id="doc-net">
                <div class="widget-header">
                    <div class="widget-title">Network Status</div>
                    <div class="widget-controls">
                        <span class="control-btn btn-min" onclick="toggleMinimize(this)">[-]</span>
                    </div>
                </div>
                
                <table class="float-right">
                    <tr>
                        <th>Node</th>
                        <th>Status</th>
                        <th>Latency</th>
                    </tr>
                    <tr>
                        <td>localhost</td>
                        <td class="status">UP</td>
                        <td>0ms</td>
                    </tr>
                    <tr>
                        <td>api</td>
                        <td class="status">UP</td>
                        <td>12ms</td>
                    </tr>
                    <tr>
                        <td>cdn</td>
                        <td class="status">UP</td>
                        <td>45ms</td>
                    </tr>
                </table>

                <p class="dim">
                    Checking connection endpoints and response times across all available nodes.
                </p>
            </div>
            
            <div class="rhs-sidebar" id="rhs-sidebar"></div>
        </div>
    </main>
    
    <footer>
        <span>Design inspired by terminal.shop | Demo Project 2025</span>
        <span>System Status: ACTIVE</span>
    </footer>
    <script>
        // Exposed to Datastar logic
        window.layout = function(focusedId) {
            const container = document.querySelector('.rhs');
            const sidebar = document.getElementById('rhs-sidebar');
            const blocks = document.querySelectorAll('.rhs-block');
            
            if (focusedId) {
                // FOCUS MODE
                container.classList.add('focus-mode');
                sidebar.style.display = 'flex';
                
                blocks.forEach(block => {
                    const wrapper = block.closest('.rhs-wrapper') || block;
                    
                    if (block.id === focusedId) {
                        // PRIMARY ITEM
                        container.insertBefore(wrapper, sidebar);
                        
                        // Expand fully
                        block.classList.add('expanded');
                        block.classList.remove('collapsed');
                        if (wrapper.classList) wrapper.classList.remove('collapsed');
                        wrapper.style.maxHeight = '';
                        
                    } else {
                        // SIDEBAR ITEM
                        sidebar.appendChild(wrapper);
                        
                        // Collapse
                        block.classList.add('collapsed');
                        block.classList.remove('expanded');
                        if (wrapper.classList) {
                            wrapper.classList.add('collapsed');
                            wrapper.style.maxHeight = '3ch';
                        }
                    }
                });
            } else {
                // DASHBOARD MODE
                container.classList.remove('focus-mode');
                sidebar.style.display = 'none';
                
                // Move everything back
                const sidebarItems = Array.from(sidebar.children);
                sidebarItems.forEach(item => {
                    container.insertBefore(item, sidebar);
                });
                
                blocks.forEach(block => {
                    const wrapper = block.closest('.rhs-wrapper') || block;
                    
                    // Reset classes
                    block.classList.remove('expanded');
                    if (wrapper.classList) {
                        wrapper.classList.remove('collapsed');
                        wrapper.style.maxHeight = '';
                    }
                });
            }
            
            // Re-check scroll indicators
            setTimeout(() => {
                blocks.forEach(b => b.dispatchEvent(new Event('scroll')));
            }, 50);
        }

        // Keep local minimize for small tweaks if needed, but Datastar handles the main layout switch
        function toggleMinimize(btn) {
             /* ... kept as legacy or local override ... */
             /* I'll simplify it to just toggle class */
             const block = btn.closest('.rhs-block');
             block.classList.toggle('collapsed');
             const wrapper = block.closest('.rhs-wrapper');
             if(wrapper) {
                 wrapper.classList.toggle('collapsed');
                 wrapper.style.maxHeight = wrapper.classList.contains('collapsed') ? '3ch' : '';
             }
             btn.textContent = block.classList.contains('collapsed') ? '[+]' : '[-]';
        }

        document.addEventListener('DOMContentLoaded', () => {
            const blocks = document.querySelectorAll('.rhs-block');
            blocks.forEach(block => {
                // Check if content overflows
                if (block.scrollHeight > block.clientHeight) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'rhs-wrapper';
                    
                    block.parentNode.insertBefore(wrapper, block);
                    wrapper.appendChild(block);
                    
                    const indicator = document.createElement('div');
                    indicator.className = 'more-indicator visible';
                    indicator.innerHTML = '<span>vvv MORE vvv</span>';
                    wrapper.appendChild(indicator);
                    
                    const checkScroll = () => {
                        const atBottom = block.scrollHeight - block.scrollTop <= block.clientHeight + 5;
                        if (atBottom || block.clientHeight >= block.scrollHeight) {
                            indicator.classList.remove('visible');
                        } else {
                            indicator.classList.add('visible');
                        }
                    };
                    
                    block.addEventListener('scroll', checkScroll);
                    // Initial check
                    checkScroll();
                }
            });
        });
    </script>
</body>
</html>
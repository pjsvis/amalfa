<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Hybrid Graph-Vector-SQL Playbook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        .connector-vertical {
            width: 2px;
            height: 20px;
            background-color: #cbd5e1;
            margin: 0 auto;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .signal-bar {
            height: 10px;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700">

    <header class="bg-slate-900 text-white py-16 px-4">
        <div class="max-w-5xl mx-auto text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight mb-4">
                <span class="text-indigo-400">Graph</span> + <span class="text-cyan-400">Vector</span> + <span class="text-fuchsia-400">SQL</span>
                <br>The Hybrid Playbook
            </h1>
            <p class="text-xl md:text-2xl text-slate-300 max-w-3xl mx-auto font-light">
                Engineering principles for high-S/N, deterministic data systems: Constrained from Ingestion to Synthesis.
            </p>
            <div class="mt-8 flex justify-center gap-4 flex-wrap">
                <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-indigo-500 shadow-lg">
                    <p class="text-xs text-slate-400 uppercase tracking-wider">Input Control</p>
                    <p class="text-2xl font-bold">Retrieval Heuristic</p>
                </div>
                <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-cyan-500 shadow-lg">
                    <p class="text-xs text-slate-400 uppercase tracking-wider">Document KPI</p>
                    <p class="text-2xl font-bold">Graph Structure</p>
                </div>
                <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-fuchsia-500 shadow-lg">
                    <p class="text-xs text-slate-400 uppercase tracking-wider">Output Control</p>
                    <p class="text-2xl font-bold">CTX Persona</p>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-12 space-y-24">

        <!-- SECTION 1: DETERMINISTIC ENGINEERING -->
        <section>
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2 border-l-8 border-cyan-500 pl-4">1. Engineering Focus: Determinism for High S/N</h2>
                <p class="text-lg leading-relaxed max-w-4xl">
                    The core engineering principle is to maximize the Signal-to-Noise (S/N) ratio from the very start. We achieve this by favoring deterministic, scripted transformations over non-deterministic, high-cost LLM generation steps. This ensures the pipeline is **repeatable**, **tunable**, and **verifiable**.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-cyan-500">
                    <h3 class="text-xl font-bold mb-3 text-cyan-700">Scripted Transformation (Signal)</h3>
                    <p class="text-sm text-slate-600 mb-4">A simple 5-line script can accomplish explicit tasks with "cool calm detachment," providing maximum signal fidelity. Use scripts for parsing, data cleansing, and explicit relationship mapping.</p>
                    <p class="font-bold mt-2">S/N Impact:</p>
                    <ul class="list-disc pl-5 text-sm text-slate-500">
                        <li>Noise Filter: Excellent</li>
                        <li>Verifiability: 100%</li>
                        <li>Cost/Latency: Low</li>
                    </ul>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-red-500">
                    <h3 class="text-xl font-bold mb-3 text-red-700">LLM Generation (Potential Noise)</h3>
                    <p class="text-sm text-slate-600 mb-4">Reserve LLMs strictly for tasks requiring genuine inference, creativity, or deep semantic interpretation (e.g., generating node descriptions). This minimizes expensive, unpredictable steps.</p>
                    <p class="font-bold mt-2">S/N Impact:</p>
                    <ul class="list-disc pl-5 text-sm text-slate-500">
                        <li>Noise Filter: Poor</li>
                        <li>Cost/Latency: High</li>
                        <li>Use Case: Inference Only</li>
                    </ul>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-indigo-500">
                    <h3 class="text-xl font-bold mb-3 text-indigo-700">Pipeline Qualities</h3>
                    <p class="text-sm text-slate-600 mb-4">The combination of modular design and deterministic scripting allows the pipeline to be high S/N, idempotent, repeatable, and easily verified against expected output.</p>
                    <p class="font-bold mt-2">Key Attributes:</p>
                    <ul class="list-disc pl-5 text-sm text-slate-500">
                        <li>**Idempotent:** Rerun without side effects.</li>
                        <li>**Tunable:** Easy parameter modification.</li>
                        <li>**Repeatable:** Consistent results across runs.</li>
                    </ul>
                </div>

            </div>
        </section>

        <!-- SECTION 2: CRITICAL INGESTION & S/N RATIO -->
        <section>
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2 border-l-8 border-fuchsia-500 pl-4">2. Ingestion Pipeline: High S/N Ratio & Early Tuning</h2>
                <p class="text-lg leading-relaxed max-w-4xl">
                    By maximizing deterministic steps, the pipeline minimizes noise from the outset. This allows for the critical tuning of semantic link generation much earlier. The **Bento Box Protocol** and **Louvain Constraint** (Max 7) are the core S/N boosters.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start">
                
                <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-md border-t-4 border-fuchsia-500">
                    <h3 class="text-xl font-bold mb-4">The Bento Box Protocol for S/N Optimization</h3>
                    
                    <div class="flex justify-between items-center text-sm font-bold text-slate-600 mb-4">
                        <span>Ingestion Quality (0% - 100%)</span>
                        <span>Resulting S/N Ratio</span>
                    </div>

                    <div class="mb-6 space-y-4">
                        <div class="flex items-center gap-4">
                            <div class="w-1/3 font-semibold">Standard Chunking (Noise)</div>
                            <div class="w-2/3 flex items-center">
                                <div class="signal-bar bg-red-400" style="width: 30%;"></div>
                                <span class="ml-4 text-sm font-mono text-red-600">Low (30%)</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="w-1/3 font-semibold">AST-Grep (Signal)</div>
                            <div class="w-2/3 flex items-center">
                                <div class="signal-bar bg-green-500" style="width: 85%;"></div>
                                <span class="ml-4 text-sm font-mono text-green-700">High (85%+)</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-slate-50 rounded border border-slate-200">
                        <h4 class="font-bold text-lg text-slate-800 mb-2">Louvain Constraint for Coherence</h4>
                        <p class="text-sm text-slate-600">
                            Restricting communities to Max 7 (Miller's Law) ensures the Agentic traversal is efficient and focused. This prevents the Agent from getting lost in a complex graph with an ambiguous, fractured narrative.
                        </p>
                    </div>
                </div>

                <div class="bg-slate-100 p-6 rounded-xl border border-slate-200">
                    <h3 class="text-lg font-bold text-center text-slate-800 mb-4">Bento Box Flow</h3>
                    
                    <div class="flex flex-col items-center">
                        <div class="bg-indigo-600 text-white p-3 rounded-lg text-sm font-bold shadow-md">Markdown Source</div>
                        <div class="connector-vertical bg-indigo-300"></div>
                        <div class="bg-indigo-500 text-white p-3 rounded-lg text-sm font-bold shadow-md">AST-Grep Parse (Scripted)</div>
                        <div class="connector-vertical bg-cyan-300"></div>
                        <div class="bg-cyan-500 text-white p-3 rounded-lg text-sm font-bold shadow-md">Logical Chunking (Scripted)</div>
                        <div class="connector-vertical bg-fuchsia-300"></div>
                        <div class="bg-fuchsia-500 text-white p-3 rounded-lg text-sm font-bold shadow-md">Link Generation & Pruning (Hybrid)</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: ALIGNMENT & CONTROL -->
        <section>
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2 border-l-8 border-indigo-600 pl-4">3. System Alignment: CTX Persona and Retrieval Heuristics</h2>
                <p class="text-lg leading-relaxed max-w-4xl">
                    Effective output requires control over both the input (retrieval) and the processing (synthesis). The **Agentic Retrieval Heuristic** ensures the high S/N context is retrieved, directly supporting the principles defined by the **CTX Persona**.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch">
                <!-- CTX Persona & Principles -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-cyan-500 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl font-bold mb-3 text-cyan-700">CTX Persona: The Operating System (Output Control)</h3>
                        <p class="text-sm text-slate-600 mb-4">The Persona constrains the LLM substrate, focusing thought on the user's principles. It dictates the synthesis style and ensures the resulting narrative is grounded and trustworthy.</p>
                        
                        <div class="space-y-3">
                            <div class="p-3 bg-slate-50 rounded border border-slate-200">
                                <span class="font-bold text-indigo-600">Principles</span>
                                <p class="text-sm text-slate-700 mt-1">Clarity, Conciseness, Veracity (Auditable Artifacts)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Proposed Heuristic -->
                <div class="bg-slate-100 p-6 rounded-xl shadow-lg border-t-4 border-indigo-500 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl font-bold mb-4 text-indigo-700">Agentic Retrieval Heuristic (Tool Use Policy, Input Control)</h3>
                        <p class="text-sm text-slate-600 mb-4">This operational heuristic is the Agent's strategy for querying the hybrid-DB, ensuring the retrieved context is laser-focussed (high S/N) for synthesis.</p>
                        
                        <div class="space-y-3">
                            <div class="p-3 bg-white rounded border border-slate-200">
                                <span class="font-bold text-fuchsia-600">IF "How" / "Why"</span>
                                <p class="text-sm font-mono text-slate-700 mt-1">V $\rightarrow$ G $\rightarrow$ (V+G Context)</p>
                            </div>
                            <div class="p-3 bg-white rounded border border-slate-200">
                                <span class="font-bold text-fuchsia-600">IF "What is the value"</span>
                                <p class="text-sm font-mono text-slate-700 mt-1">V $\rightarrow$ S $\rightarrow$ (G Context)</p>
                            </div>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 mt-4 italic">
                        The Heuristic ensures the Agent gets "Bang for its Buck" by synthesizing, not sifting.
                    </p>
                </div>
            </div>
        </section>

        <!-- SECTION 4: VALIDATION: STRUCTURE AS DIAGNOSTIC -->
        <section>
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2 border-l-8 border-fuchsia-500 pl-4">4. Validation: Structure as Diagnostic</h2>
                <p class="text-lg leading-relaxed max-w-4xl">
                    The hybrid architecture is inherently self-diagnostic. If structure is absent after ingestion, the statistics derived from the graph (Louvain modularity, semantic edge frequency) provide precise data points for parameter tuning.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-bold mb-4 text-center">System Performance Comparison</h3>
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                    <p class="text-sm text-slate-500 mt-4 text-center italic">
                        The Poly Hybrid maximizes Hallucination Resistance (due to Graph/SQL constraints) and Semantic Depth.
                    </p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-cyan-500">
                    <h3 class="text-xl font-bold mb-4">Community Density vs. Narrative Coherence</h3>
                    <div class="chart-container">
                        <canvas id="communityChart"></canvas>
                    </div>
                    <p class="text-sm text-slate-600 mt-4 italic">
                        The optimized Max 7 community constraint yields the highest coherence score when the Agent is tasked with generating a project history.
                    </p>
                </div>
            </div>
        </section>
        
        <!-- SECTION 5: CONCLUSION -->
        <section class="bg-slate-100 p-8 md:p-12 rounded-xl shadow-inner">
            <h2 class="text-3xl md:text-4xl font-extrabold text-slate-900 mb-6 text-center">
                5. Conclusion: Graph Structure is Document Quality KPI
            </h2>
            <div class="max-w-4xl mx-auto space-y-6">
                <p class="text-xl leading-relaxed text-slate-700 text-center">
                    The final measure of the entire pipeline—from ingestion to tuning—is the ability to **discern structures in the graph**. The topological output is not just data; it is an auditable metric of the source document set's intrinsic signal quality.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4">
                    <div class="bg-white p-6 rounded-lg border-l-4 border-green-500 shadow-md">
                        <h3 class="font-bold text-xl text-green-700 mb-2">Structure Found: High Signal</h3>
                        <p class="text-sm text-slate-600">
                            The Louvain modularity score is high, the semantic edges are logical, and the Agent produces a coherent narrative. The document set is validated as high-fidelity and well-organized.
                        </p>
                    </div>
                    <div class="bg-white p-6 rounded-lg border-l-4 border-red-500 shadow-md">
                        <h3 class="font-bold text-xl text-red-700 mb-2">No Structure: Document Noise</h3>
                        <p class="text-sm text-slate-600">
                            If, after running the idempotent process and tuning all parameters, structure fails to emerge, the implication is clear: **the source document set is fundamentally noise.**
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 6: PLAYBOOK & BEST PRACTICES (RENUMBERED) -->
        <section class="bg-slate-900 text-white -mx-4 px-4 py-16 md:px-12 md:rounded-3xl shadow-2xl">
            <h2 class="text-3xl md:text-4xl font-bold mb-8 text-center"><span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-indigo-400">6. The Hybrid Playbook: Actionable Checklist</span></h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Card 1 (Tune S/N) -->
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-cyan-500 transition-colors">
                    <div class="text-cyan-400 text-3xl mb-4">01</div>
                    <h3 class="text-xl font-bold mb-3">Tune for High S/N Ratio</h3>
                    <p class="text-slate-400 text-sm mb-4">Prioritize deterministic scripting (AST-Grep) to eliminate noise early. Use the modular pipeline to iteratively adjust parameters until a high S/N ratio is confirmed.</p>
                    <div class="bg-slate-900 p-3 rounded text-xs font-mono text-cyan-300">
                        Goal: Optimize for High S/N From Ingestion
                    </div>
                </div>

                <!-- Card 2 (Agentic Validation) -->
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-fuchsia-500 transition-colors">
                    <div class="text-fuchsia-400 text-3xl mb-4">02</div>
                    <h3 class="text-xl font-bold mb-3">Louvain Constraint (Max 7)</h3>
                    <p class="text-slate-400 text-sm mb-4">Enforce a strict maximum of 7 top-level Louvain communities to align graph complexity with cognitive capacity. Validate this constraint using the Agentic Narrative test.</p>
                    <div class="bg-slate-900 p-3 rounded text-xs font-mono text-fuchsia-300">
                        Rule: Community Count $\leq 7$
                    </div>
                </div>

                <!-- Card 3 (Hybrid Retrieval) -->
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-indigo-500 transition-colors">
                    <div class="text-indigo-400 text-3xl mb-4">03</div>
                    <h3 class="text-xl font-bold mb-3">Align Input with CTX Persona</h3>
                    <p class="text-slate-400 text-sm mb-4">Use the Retrieval Heuristic to ensure input context is laser-focused and aligned with the Persona's principles (clarity, veracity) before the Agent begins synthesis.</p>
                    <div class="bg-slate-900 p-3 rounded text-xs font-mono text-indigo-300">
                        Heuristic $\rightarrow$ Context $\rightarrow$ Persona
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-100 py-8 text-center text-slate-500 text-sm">
        <p>Generated for the Poly Project &bull; Hybrid Database Architecture Review</p>
    </footer>

    <script>
        function formatLabel(str, maxwidth) {
            if (typeof str !== 'string') return str;
            if (str.length <= maxwidth) return str;
            
            const words = str.split(' ');
            const lines = [];
            let line = "";

            words.forEach(word => {
                if ((line + word).length > maxwidth) {
                    lines.push(line.trim());
                    line = word + " ";
                } else {
                    line += word + " ";
                }
            });
            lines.push(line.trim());
            return lines;
        }

        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) {
                                return label.join(' ');
                            } else {
                                return label;
                            }
                        }
                    }
                },
                legend: {
                    labels: {
                        font: { family: 'Inter', size: 12 },
                        usePointStyle: true,
                        color: '#475569'
                    }
                }
            }
        };

        const ctxRadar = document.getElementById('radarChart').getContext('2d');
        const radarLabels = ["Narrative Context", "Hallucination Resistance", "Data Freshness (SQL)", "Query Flexibility", "Semantic Depth"];
        const wrappedRadarLabels = radarLabels.map(l => formatLabel(l, 16));

        new Chart(ctxRadar, {
            type: 'radar',
            data: {
                labels: wrappedRadarLabels,
                datasets: [
                    {
                        label: 'Poly Hybrid (G+V+SQL)',
                        data: [95, 95, 90, 90, 95],
                        fill: true,
                        backgroundColor: 'rgba(79, 70, 229, 0.2)',
                        borderColor: '#4f46e5',
                        pointBackgroundColor: '#4f46e5',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#4f46e5'
                    },
                    {
                        label: 'Standard Vector RAG',
                        data: [50, 40, 60, 60, 70],
                        fill: true,
                        backgroundColor: 'rgba(6, 182, 212, 0.2)',
                        borderColor: '#06b6d4',
                        pointBackgroundColor: '#06b6d4',
                        pointBorderColor: '#fff'
                    },
                    {
                        label: 'Pure Knowledge Graph',
                        data: [80, 85, 20, 30, 40],
                        fill: true,
                        backgroundColor: 'rgba(148, 163, 184, 0.2)',
                        borderColor: '#94a3b8',
                        pointBackgroundColor: '#94a3b8',
                        pointBorderColor: '#fff'
                    }
                ]
            },
            options: {
                ...commonOptions,
                scales: {
                    r: {
                        angleLines: { color: '#e2e8f0' },
                        grid: { color: '#e2e8f0' },
                        pointLabels: {
                            font: { family: 'Inter', size: 11 },
                            color: '#64748b'
                        },
                        ticks: { display: false }
                    }
                }
            }
        });

        const ctxBar = document.getElementById('communityChart').getContext('2d');
        const barLabels = ["Unconstrained Graph", "Optimized (Max 7)", "Over-Pruned (Max 3)"];
        const wrappedBarLabels = barLabels.map(l => formatLabel(l, 16));

        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: wrappedBarLabels,
                datasets: [{
                    label: 'Agent Narrative Coherence Score (0-100)',
                    data: [45, 92, 60],
                    backgroundColor: [
                        '#94a3b8',
                        '#d946ef',
                        '#cbd5e1'
                    ],
                    borderRadius: 6
                }]
            },
            options: {
                ...commonOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: { color: '#f1f5f9' },
                        ticks: { font: { family: 'Inter' } }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { font: { family: 'Inter' } }
                    }
                }
            }
        });

    </script>
</body>
</html>